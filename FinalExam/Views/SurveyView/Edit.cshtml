@{
    ViewData["Title"] = "問卷設計頁面";
}

<div class="container mt-5">
    <h1 class="mb-4">問卷設計頁面</h1>
    <div id="questions"></div>
    <button id="add-question" class="btn btn-primary">添加問題</button>
    <button id="submit-questionnaire" class="btn btn-primary">提交問卷</button>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script>
    $(document).ready(function () {
        let questionCount = 1;

        function loadQuestionnaire(questionnaire) {
            $('#questions').empty();
            questionnaire.questions.forEach(function (question, index) {
                const questionHtml = `
                    <div class="question-container card p-3 mb-3">
                        <div class="form-group">
                            <label for="question-${index + 1}">問題 ${index + 1}</label>
                            <input type="text" class="form-control" id="question-${index + 1}" value="${question.questionText}">
                        </div>
                        <div class="form-group question-type">
                            <label for="question-type-${index + 1}">選擇問題類型</label>
                            <select class="form-control question-type-select" id="question-type-${index + 1}">
                                <option value="multiple-choice" ${question.questionType === 'multiple-choice' ? 'selected' : ''}>多選</option>
                                <option value="single-choice" ${question.questionType === 'single-choice' ? 'selected' : ''}>單選</option>
                                <option value="text" ${question.questionType === 'text' ? 'selected' : ''}>問答</option>
                            </select>
                        </div>
                        <div class="options">
                            ${question.options.map(option => `
                                <div class="option-container">
                                    <input type="text" class="form-control" value="${option.optionText}">
                                </div>`).join('')}
                        </div>
                        <button class="btn btn-secondary btn-sm add-option">添加選項</button>
                        <button class="btn btn-danger btn-sm remove-question">删除問題</button>
                    </div>
                `;
                $('#questions').append(questionHtml);
            });
        }

        // 从 URL 获取问卷 ID
        const urlParams = new URLSearchParams(window.location.search);
        const questionnaireID = urlParams.get('id');

        if (questionnaireID) {
            $.ajax({
                type: "GET",
                url: `/api/Survay/get-questionnaire/${questionnaireID}`, // 根据问卷 ID 获取问卷数据
                success: function (data) {
                    console.log(data);
                    loadQuestionnaire(data); // 加载问卷数据
                },
                error: function () {
                    alert("加载问卷失败，请重试！");
                }
            });
        }

        // Dynamic event handlers for adding/removing questions and options...
    });
</script>
