<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .question-container {
            margin-bottom: 20px;
        }

        .option-container {
            margin-bottom: 10px;
        }

        .required-indicator {
            color: red;
            font-weight: bold;
        }

        .is-invalid {
            border: 2px solid red;
        }

        .error-message {
            color: red;
            margin-top: 5px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h1 class="mb-4">回答問卷</h1>

        <form id="survey-form" novalidate>
            @for (int i = 0; i < Model.Questions.Count; i++)
            {
                var question = Model.Questions[i];
                <div class="question-container card p-3 mb-3" id="question-container-@i">
                    <div class="form-group">
                        <label for="question-@i">
                            @question.Text
                            @if (question.IsRequired)
                            {
                                <span class="required-indicator">*</span>
                            }
                        </label>

                        @if (question.Options != null && question.Options.Count > 0)
                        {
                            @foreach (var option in question.Options)
                            {
                                @if (question.IsMultipleChoice)
                                {
                                    <div class="form-check">
                                        <input type="checkbox" class="form-check-input" id="option-@i-@option.Text" name="question-@i-options" @(question.IsRequired ? "required" : "")>
                                        <label class="form-check-label" for="option-@i-@option.Text">@option.Text</label>
                                    </div>
                                }
                                else
                                {
                                    <div class="form-check">
                                        <input type="radio" class="form-check-input" id="option-@i-@option.Text" name="question-@i-options" @(question.IsRequired ? "required" : "")>
                                        <label class="form-check-label" for="option-@i-@option.Text">@option.Text</label>
                                    </div>
                                }
                            }
                        }
                        else
                        {
                            <input type="text" class="form-control" id="question-@i" placeholder="輸入你的答案" @(question.IsRequired ? "required" : "")>
                        }

                        @if (question.IsRequired)
                        {
                            <div class="error-message" id="error-message-@i">此問題為必填項。</div>
                        }

                    </div>
                </div>
            }
            <button type="submit" class="btn btn-primary">提交問卷</button>
        </form>

    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
        $(document).ready(function () {
            // 提交問卷時驗證必填問題是否已填寫
            $('#survey-form').submit(function (event) {
                event.preventDefault(); // 防止表單提交

                let isValid = true;

                // 清除先前的錯誤消息
                $('.is-invalid').removeClass('is-invalid');
                $('.error-message').hide();

                $('#survey-form .question-container').each(function () {
                    const questionContainer = $(this);
                    const input = questionContainer.find('input[type="text"][required], textarea[required]');
                    const options = questionContainer.find('input[type="radio"][required], input[type="checkbox"][required]');
                    const errorMessage = questionContainer.find('.error-message');

                    if (input.length && input.val().trim() === '') {
                        isValid = false;
                        questionContainer.addClass('is-invalid');
                        errorMessage.show();
                    } else if (options.length && options.filter(':checked').length === 0) {
                        isValid = false;
                        questionContainer.addClass('is-invalid');
                        errorMessage.show();
                    }
                });

                if (isValid) {
                    alert('問卷提交成功！');
                    // 在這裡可以添加代碼來處理表單數據，例如發送到服務器
                } else {
                    alert('請填寫所有必填問題。');
                }
            });
        });
    </script>
</body>
</html>
